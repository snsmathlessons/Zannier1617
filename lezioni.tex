% This is a modified version of the tufte-latex book example in which the title page and the contents page resemble Tufte's
% VDQI book, using Kevin Godby's code from this thread at https://groups.google.com/forum/#!topic/tufte-latex/ujdzrktC1BQ.
% Taken from https://www.overleaf.com/5902299yxkgzs#/19519356/
\documentclass[a4paper,oneside]{tufte-book}
\usepackage{nameref}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[italian]{babel}
\usepackage{ragged2e}
\usepackage{marginfix}
\usepackage{tikz}
\usepackage{epstopdf}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{etoolbox}
\usepackage{afterpage}

% \DeclareSymbolFont{operators}   {OT1}{cmr} {m}{n}
% \DeclareSymbolFont{letters}     {OML}{cmm} {m}{it}
% \DeclareSymbolFont{symbols}     {OMS}{cmsy}{m}{n}
% \DeclareSymbolFontAlphabet{\mathrm}    {operators}
% \DeclareSymbolFontAlphabet{\mathnormal}{letters}
% \DeclareSymbolFontAlphabet{\mathcal}   {symbols}
% \DeclareSymbolFontAlphabet{\mathfrak}  {symbols}
% \DeclareMathAlphabet      {\mathbf}{OT1}{cmr}{bx}{n}
% \DeclareMathAlphabet      {\mathsf}{OT1}{cmss}{m}{n}
% \DeclareMathAlphabet      {\mathit}{OT1}{cmr}{m}{it}
% \DeclareMathAlphabet      {\mathtt}{OT1}{cmtt}{m}{n}
% \DeclareMathAlphabet      {\mathbb}{OT1}{cmr}{m}{n}
% \DeclareMathAlphabet      {\mathfrak}{OT1}{euler}{m}{n}

\usepackage{enumitem}
\setlist{nolistsep}
\setitemize[0]{leftmargin=20pt, itemindent=0pt, labelsep=10pt,
  listparindent=0pt}
\setenumerate[0]{leftmargin=40pt, itemindent=0pt, labelsep=10pt,
  listparindent=0pt}

\geometry{
  a4paper,
  left=18mm,
  textwidth=170mm, % main text block
  marginparsep=0mm, % gutter between main text block and margin notes
  marginparwidth=0mm % width of margin notes
}

% Cambiamo l'impostazione di tufte-common e non mettiamo spazio sopra i
% titoli di inizio capitolo
\titlespacing*{\chapter}{0pt}{0pt}{0pt}

\titleformat{\chapter}%
[hang]%shape
{\scshape\huge\raggedright}%
{\thesection}%
{0.5em}%
{}%
[\vskip 1em]%

% Cambiamo anche l'impostazione di come vengono visualizzati i titoli di
% sezione, li vogliamo in maiuscoletto
\titleformat{\section}%
[hang]% shape
{\scshape\LARGE\raggedright}% format to label + text
{\thesection}% label
{1em}% separation between label and title body
{}% before the title body
[]% after the title body

\titleformat{\subsection}%
[hang]%
{\scshape\Large\raggedright}%
{\thesection}%
{1em}%
{}%
[]%

\include{custom-commands}


% Manteniamo le note a piè di pagina nella stessa pagina
\interfootnotelinepenalty=10000
\makeatletter
% Eventualmente si può mettere un \nohyphenation prima di justify ma poi
% le note a margine vengono in maniera terribile.
\renewcommand\@makefntext[1]{\justify\@makefnmark#1}
\makeatother

% Book metadata
\title{Funzioni Ellittiche e Modulari}
\date{Note di un corso del Prof. Umberto Zannier}
\author[]{Classe del Terzo Anno SNS}
\publisher{Versione del \dateitalian\today}

% Just some sample text
%\usepackage{lipsum}

% For nicely typeset tabular material
\usepackage{booktabs}

% For graphics / images
\usepackage{graphicx}
\setkeys{Gin}{width=\linewidth,totalheight=\textheight,keepaspectratio}
\graphicspath{{lezioni/immagini/}}

% The fancyvrb package lets us customize the formatting of verbatim
% environments.  We use a slightly smaller font.
\usepackage{fancyvrb}
\fvset{fontsize=\normalsize}

% Prints argument within hanging parentheses (i.e., parentheses that take
% up no horizontal space).  Useful in tabular environments.
\newcommand{\hangp}[1]{\makebox[0pt][r]{(}#1\makebox[0pt][l]{)}}

% Prints an asterisk that takes up no horizontal space.
% Useful in tabular environments.
\newcommand{\hangstar}{\makebox[0pt][l]{*}}

% Prints a trailing space in a smart way.
\usepackage{xspace}

% Prints the month name (e.g., January) and the year (e.g., 2008)
\newcommand{\monthyear}{%
  \ifcase\month\or January\or February\or March\or April\or May\or June\or
  July\or August\or September\or October\or November\or
  December\fi\space\number\year
}


% Prints an epigraph and speaker in sans serif, all-caps type.
\newcommand{\openepigraph}[2]{%
  %\sffamily\fontsize{14}{16}\selectfont
  \begin{fullwidth}
  \sffamily\large
  \begin{doublespace}
  \noindent\allcaps{#1}\\% epigraph
  \noindent\allcaps{#2}% author
  \end{doublespace}
  \end{fullwidth}
}

% Inserts a blank page
\newcommand{\blankpage}{\newpage\hbox{}\thispagestyle{empty}\newpage}

\usepackage{units}

% Typesets the font size, leading, and measure in the form of 10/12x26 pc.
\newcommand{\measure}[3]{#1/#2$\times$\unit[#3]{pc}}

% Macros for typesetting the documentation
\newcommand{\hlred}[1]{\textcolor{Maroon}{#1}}% prints in red
\newcommand{\hangleft}[1]{\makebox[0pt][r]{#1}}
\newcommand{\hairsp}{\hspace{1pt}}% hair space
\newcommand{\hquad}{\hskip0.5em\relax}% half quad space
\newcommand{\TODO}{\textcolor{red}{\bf TODO!}\xspace}
\newcommand{\ie}{\textit{i.\hairsp{}e.}\xspace}
\newcommand{\eg}{\textit{e.\hairsp{}g.}\xspace}
\newcommand{\na}{\quad--}% used in tables for N/A cells
\providecommand{\XeLaTeX}{X\lower.5ex\hbox{\kern-0.15em\reflectbox{E}}\kern-0.1em\LaTeX}
\newcommand{\tXeLaTeX}{\XeLaTeX\index{XeLaTeX@\protect\XeLaTeX}}
% \index{\texttt{\textbackslash xyz}@\hangleft{\texttt{\textbackslash}}\texttt{xyz}}
\newcommand{\tuftebs}{\symbol{'134}}% a backslash in tt type in OT1/T1
\newcommand{\doccmdnoindex}[2][]{\texttt{\tuftebs#2}}% command name -- adds backslash automatically (and doesn't add cmd to the index)
\newcommand{\doccmddef}[2][]{%
  \hlred{\texttt{\tuftebs#2}}\label{cmd:#2}%
  \ifthenelse{\isempty{#1}}%
    {% add the command to the index
      \index{#2 command@\protect\hangleft{\texttt{\tuftebs}}\texttt{#2}}% command name
    }%
    {% add the command and package to the index
      \index{#2 command@\protect\hangleft{\texttt{\tuftebs}}\texttt{#2} (\texttt{#1} package)}% command name
      \index{#1 package@\texttt{#1} package}\index{packages!#1@\texttt{#1}}% package name
    }%
}% command name -- adds backslash automatically
\newcommand{\doccmd}[2][]{%
  \texttt{\tuftebs#2}%
  \ifthenelse{\isempty{#1}}%
    {% add the command to the index
      \index{#2 command@\protect\hangleft{\texttt{\tuftebs}}\texttt{#2}}% command name
    }%
    {% add the command and package to the index
      \index{#2 command@\protect\hangleft{\texttt{\tuftebs}}\texttt{#2} (\texttt{#1} package)}% command name
      \index{#1 package@\texttt{#1} package}\index{packages!#1@\texttt{#1}}% package name
    }%
}% command name -- adds backslash automatically
\newcommand{\docopt}[1]{\ensuremath{\langle}\textrm{\textit{#1}}\ensuremath{\rangle}}% optional command argument
\newcommand{\docarg}[1]{\textrm{\textit{#1}}}% (required) command argument
\newenvironment{docspec}{\begin{quotation}\ttfamily\parskip0pt\parindent0pt\ignorespaces}{\end{quotation}}% command specification environment
\newcommand{\docenv}[1]{\texttt{#1}\index{#1 environment@\texttt{#1} environment}\index{environments!#1@\texttt{#1}}}% environment name
\newcommand{\docenvdef}[1]{\hlred{\texttt{#1}}\label{env:#1}\index{#1 environment@\texttt{#1} environment}\index{environments!#1@\texttt{#1}}}% environment name
\newcommand{\docpkg}[1]{\texttt{#1}\index{#1 package@\texttt{#1} package}\index{packages!#1@\texttt{#1}}}% package name
\newcommand{\doccls}[1]{\texttt{#1}}% document class name
\newcommand{\docclsopt}[1]{\texttt{#1}\index{#1 class option@\texttt{#1} class option}\index{class options!#1@\texttt{#1}}}% document class option name
\newcommand{\docclsoptdef}[1]{\hlred{\texttt{#1}}\label{clsopt:#1}\index{#1 class option@\texttt{#1} class option}\index{class options!#1@\texttt{#1}}}% document class option name defined
\newcommand{\docmsg}[2]{\bigskip\begin{fullwidth}\noindent\ttfamily#1\end{fullwidth}\medskip\par\noindent#2}
\newcommand{\docfilehook}[2]{\texttt{#1}\index{file hooks!#2}\index{#1@\texttt{#1}}}
\newcommand{\doccounter}[1]{\texttt{#1}\index{#1 counter@\texttt{#1} counter}}

% Generates the index
\usepackage{makeidx}
\makeindex

%%%% Kevin Godny's code for title page and contents from https://groups.google.com/forum/#!topic/tufte-latex/ujdzrktC1BQ
\makeatletter
\renewcommand{\maketitlepage}{%
  \setlength{\parindent}{0pt}
  
  \fontsize{24}{24}\selectfont\textit{\@author}
  
  \vspace{1.75in}\fontsize{36}{54}\selectfont\@title
  
  \vspace{0.5in}\fontsize{14}{14}\selectfont\textsf{\smallcaps{\@date}}
  
  \vfill\fontsize{14}{14}\selectfont\textit{\@publisher}
  
  \thispagestyle{empty}
}
\newcommand{\makefrontcover}{%
% Cerchiamo di includere la copertina con la figura
\afterpage{%
  \newpage%
  \thispagestyle{empty}%
  \newgeometry{margin=0mm, top=0mm, bottom=0mm, left=0mm, right=0mm}
  \begin{textblock*}{\paperwidth}(0pt,0pt)%
    {%
      \transparent{0.4}%
      \begin{center}
        \noindent\includegraphics*[height=\paperheight,width=\paperwidth]{cubicgrouplaw.eps}%
      \end{center}%
    }%
  \end{textblock*}%
  \begin{textblock*}{\paperwidth}(-20mm,63mm)%
    {%
      \transparent{0.90}%
      \crule[white]{2\paperwidth}{50mm}
      %\fbox{\crule[white]{\paperwidth}{50mm}}
    }%
  \end{textblock*}%
  \begin{textblock*}{\paperwidth}(0mm,67mm)%
    {
      \makeatletter
      \begin{center}
        {\fontsize{32}{20}\selectfont\@title}
      \end{center}
      \vspace{0.5in}
      \begin{center}
        {\fontsize{14}{14}\selectfont\textsf{\smallcaps{\@date}}}
      \end{center}
      \makeatother
    }
  \end{textblock*}
  \null%
  \restoregeometry%
  \newpage%
}
}
\makeatother

\titlecontents{part}%
    [0pt]% distance from left margin
    {\addvspace{0.25\baselineskip}}% above (global formatting of entry)
    {\allcaps{Part~\thecontentslabel}\allcaps}% before w/ label (label = ``Part I'')
    {\allcaps{Part~\thecontentslabel}\allcaps}% before w/o label
    {}% filler and page (leaders and page num)
    [\vspace*{0.5\baselineskip}]% after

\titlecontents{chapter}%
    [4em]% distance from left margin
    {}% above (global formatting of entry)
    {\contentslabel{2em}\textit}% before w/ label (label = ``Chapter 1'')
    {\hspace{0em}\textit}% before w/o label
    {\qquad\thecontentspage}% filler and page (leaders and page num)
    [\vspace*{0.5\baselineskip}]% after
%%%% End additional code by Kevin Godby

    \usepackage{amsthm}
    
    \newcounter{gencounter}
    \newcounter{defcounter}
    \newcounter{escounter}

    \linespread{1.2}

    \newtheoremstyle{importante}% <name>
    {\baselineskip}% <Space above>
    {\baselineskip}% <Space below>
    {}% <Body font>
    {}% <Indent amount>
    {\scshape}% <Theorem head font>
    {:}% <Punctation after theorem head>
    {1em}% <Space after theorem head>
    {}% <Theorem head spec>
    
    \theoremstyle{importante}
    \newtheorem{teorema}[gencounter]{Teorema}
    \newtheorem{lemma}[gencounter]{Lemma}
    \newtheorem{definizione}[defcounter]{Definizione}

    \newtheorem{esercizio}[escounter]{Esercizio}
    
    \newtheorem{corollario}[gencounter]{Corollario}
    \newtheorem{osservazione}[defcounter]{Osservazione}
    \newtheorem{remark}[defcounter]{Remark}

    \newcommand{\notamargine}[1]{
      \vspace{-7\baselineskip}
      \let\thefootnote\relax\footnotetext{#1}
      \vspace{7\baselineskip}
    }

    \newcommand\crule[3][black]{\textcolor{#1}{\rule{#2}{#3}}}

    \usepackage{transparent}
    \usepackage[absolute]{textpos}
    
\begin{document}
\makefrontcover

% Front matter
\frontmatter

% r.1 blank page
% \blankpage

% v.2 epigraphs
% \newpage\thispagestyle{empty}
% \openepigraph{%
% The public is more familiar with bad design than good design.
% It is, in effect, conditioned to prefer bad design, 
% because that is what it lives with. 
% The new becomes threatening, the old reassuring.
% }{Paul Rand%, {\itshape Design, Form, and Chaos}
% }
% \vfill
% \openepigraph{%
% A designer knows that he has achieved perfection 
% not when there is nothing left to add, 
% but when there is nothing left to take away.
% }{Antoine de Saint-Exup\'{e}ry}
% \vfill
% \openepigraph{%
% \ldots the designer of a new system must not only be the implementor and the first 
% large-scale user; the designer should also write the first user manual\ldots 
% If I had not participated fully in all these activities, 
% literally hundreds of improvements would never have been made, 
% because I would never have thought of them or perceived 
% why they were important.
% }{Donald E. Knuth}


% r.3 full title page
\maketitle

% v.4 copyright page
\newpage
\newcommand{\contributori}{Nomi di tutti da aggiungere}
\begin{fullwidth}
\begin{doublespace}
  \thispagestyle{empty}
  \setlength{\parindent}{0pt}
  \setlength{\parskip}{\baselineskip}
  \noindent\fontsize{16}{16}\selectfont\scshape
  \par\nohyphenation Hanno collaborato alla stesura di questo testo: \contributori
\end{doublespace}

~\vfill
\thispagestyle{empty}
\setlength{\parindent}{0pt}
\setlength{\parskip}{\baselineskip}
Copyright \copyright\ \the\year\ \contributori

%\par\smallcaps{Pubblicato da \thanklesspublisher}

\par\smallcaps{zannier1617.surge.sh}

\par\justify\nohyphenation This text is licensed under a Creative Commons
\smallcaps{``Attribution-ShareAlike 4.0 International''}
license (the ``License''). You may not use this file
except in compiance with the License. You may obtain a
copy of the License at \url{https://creativecommons.org/licenses/by-sa/4.0/legalcode}.

\includegraphics[width=5em]{by-sa.eps}
\index{license}

%\par\textit{First printing, \monthyear}
\end{fullwidth}

% r.5 contents
\tableofcontents

%\listoffigures
%\listoftables

% r.7 dedication
%\cleardoublepage
%~\vfill
%\begin{doublespace}
%\noindent\fontsize{18}{22}\selectfont\itshape
%\nohyphenation
%Scritto con la collaborazione di tutta la classe del
%Terzo Anno di Matematica della SNS dell' anno 2016-2017
%
%Qui ci andranno i nomi di tutti quanti.
%\end{doublespace}
%\vfill
%\vfill

% r.9 introduction
% \cleardoublepage
%\include{lezioni/lezione-introduzione}

% Start the main matter (normal chapters)
\mainmatter
% Regoliamo ora i margini del documento e lo spazio che lasciamo alle
% note a margine.
\newgeometry{
  left=12mm, % left margin
  textwidth=150mm, % main text block
  marginparsep=6mm, % gutter between main text block and margin notes
  marginparwidth=35mm, % width of margin notes
  headsep=8mm,
  footskip=20pt,
  top=2.5cm,
  bottom=1.5cm,
  showframe
}

% Cambiamo il font per metterlo più piccolo
\fontsize{11}{14}\selectfont

% Mettiamo indentazione e skip tra i paragrafi
\makeatletter
% Paragraph indentation and separation for normal text
\renewcommand{\@tufte@reset@par}{%
  \setlength{\RaggedRightParindent}{1.0pc}%
  \setlength{\JustifyingParindent}{1.0pc}%
  \setlength{\parindent}{0pc}%
  \setlength{\parskip}{0.3\baselineskip}%
}
\@tufte@reset@par

% Paragraph indentation and separation for marginal text
\renewcommand{\@tufte@margin@par}{%
  \setlength{\RaggedRightParindent}{0.5pc}%
  \setlength{\JustifyingParindent}{0.5pc}%
  \setlength{\parindent}{0pc}%
  \setlength{\parskip}{0.3\baselineskip}%
}
\makeatother

\setlength{\parskip}{0cm}
\setlength{\parindent}{0cm}

\include{lezioni/lezione-160919}

\end{document}

